# üì® –ú–ù–û–ñ–ï–°–¢–í–ï–ù–ù–ê–Ø –û–¢–ü–†–ê–í–ö–ê TELEGRAM –°–û–û–ë–©–ï–ù–ò–ô

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞
–†–∞–Ω–µ–µ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ **–æ–¥–Ω–æ–º—É –ø–æ–ª—É—á–∞—Ç–µ–ª—é**, –¥–∞–∂–µ –µ—Å–ª–∏ –≤ `TELEGRAM_CHAT_ID` –±—ã–ª–æ —É–∫–∞–∑–∞–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ ID —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é.

### –†–µ—à–µ–Ω–∏–µ
–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ chat_id**:
- ‚úÖ –†–∞–∑–¥–µ–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –ø–æ –∑–∞–ø—è—Ç–æ–π
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∂–¥–æ–º—É –ø–æ–ª—É—á–∞—Ç–µ–ª—é
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

## üìã –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `/app/api/contact/route.ts`
**–û—Å–Ω–æ–≤–Ω–æ–π endpoint –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏**

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è:
```typescript
// ‚ùå –ë–´–õ–û (–æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–º—É –ø–æ–ª—É—á–∞—Ç–µ–ª—é)
const chatId = process.env.TELEGRAM_CHAT_ID;
await fetch(`...sendMessage`, {
  body: JSON.stringify({ chat_id: chatId, text })
});

// ‚úÖ –°–¢–ê–õ–û (–æ—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è–º)
const chatIdsRaw = process.env.TELEGRAM_CHAT_ID;
const chatIds = chatIdsRaw.split(',').map(id => id.trim()).filter(Boolean);

const sendPromises = chatIds.map(async (chatId, index) => {
  console.log(`[Telegram] Sending to chat_id #${index + 1}: ${chatId}`);
  // ... –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
});
```

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ chat_id –ø–æ –∑–∞–ø—è—Ç–æ–π
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤—Å–µ–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è–º
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
- –ü–æ–¥—Å—á–µ—Ç —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É–¥–∞—á–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫
- –í–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ

---

### 2. `/lib/telegram.ts`
**–û—Å–Ω–æ–≤–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram API**

#### –£–ª—É—á—à–µ–Ω–∏—è:
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ chat_id
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –≠–º–æ–¥–∑–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –§–æ—Ä–º–∞—Ç TELEGRAM_CHAT_ID
–í `.env` —Ñ–∞–π–ª–µ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ chat_id —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é:

```bash
# –û–¥–∏–Ω –ø–æ–ª—É—á–∞—Ç–µ–ª—å
TELEGRAM_CHAT_ID=277767867

# –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
TELEGRAM_CHAT_ID=277767867,956005680

# –° –ø—Ä–æ–±–µ–ª–∞–º–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—é—Ç—Å—è)
TELEGRAM_CHAT_ID=277767867, 956005680, 123456789
```

---

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤

#### –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:
```
[Telegram] Sending message to 2 recipient(s): 277767867, 956005680
[Telegram] Sending to chat_id #1: 277767867
[Telegram] üîÑ Preparing message for chat 277767867 (app: ZD-1699123456-ABC123DEF)
[Telegram] üì° Sending HTTP request to Telegram API for chat 277767867...
[Telegram] ‚úÖ Message successfully sent to chat 277767867, message_id: 12345
[Telegram] Sending to chat_id #2: 956005680
[Telegram] üîÑ Preparing message for chat 956005680 (app: ZD-1699123456-ABC123DEF)
[Telegram] üì° Sending HTTP request to Telegram API for chat 956005680...
[Telegram] ‚úÖ Message successfully sent to chat 956005680, message_id: 12346
```

#### –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
```
[Telegram] üìä Results: 2 successful, 0 failed out of 2 total
  ‚úÖ Chat 277767867: Delivered
  ‚úÖ Chat 956005680: Delivered
```

#### –ü—Ä–∏ –æ—à–∏–±–∫–µ:
```
[Telegram] ‚ùå Failed to send to 123456789: Bad Request: chat not found
[Telegram] üìä Results: 1 successful, 1 failed out of 2 total
  ‚úÖ Chat 277767867: Delivered
  ‚ùå Chat 123456789: Failed - Bad Request: chat not found
```

---

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –§–æ—Ä–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ (`/api/contact`)

**Request:**
```json
POST /api/contact
{
  "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "phone": "+7 930 123 45 67",
  "email": "ivan@example.com",
  "message": "–ò–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –∫—É—Ö–Ω—è 5–º"
}
```

**Response (—É—Å–ø–µ—Ö):**
```json
{
  "ok": true,
  "delivered": 2,
  "failed": 0,
  "total": 2
}
```

**Response (—á–∞—Å—Ç–∏—á–Ω—ã–π —É—Å–ø–µ—Ö):**
```json
{
  "ok": true,
  "delivered": 1,
  "failed": 1,
  "total": 2
}
```

---

### 2. –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `lib/telegram.ts`)

**–ö–æ–¥:**
```typescript
import { sendContactFormToTelegram } from '@/lib/telegram';

const result = await sendContactFormToTelegram({
  name: '–ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞',
  phone: '+7 930 987 65 43',
  message: '–†–∞—Å—á–µ—Ç –∫—É—Ö–Ω–∏: –£–≥–ª–æ–≤–∞—è 6–º, –ú–î–§, –ü—Ä–µ–º–∏—É–º Blum',
  source: 'calculator'
});

// result.success - –æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å
// result.applicationId - ID –∑–∞—è–≤–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
```

---

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### 1. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**
- –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –≤—Å–µ—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- –ï—Å–ª–∏ –æ–¥–∏–Ω chat –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ–ª—É—á–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ

### 2. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
- –õ–µ–≥–∫–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º chat_id

### 3. **–ì–∏–±–∫–æ—Å—Ç—å**
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª—é–±–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ chat_id

### 4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
- API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É–¥–∞—á–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫
- –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ development —Ä–µ–∂–∏–º–µ:
```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ dev-—Å–µ—Ä–≤–µ—Ä
npm run dev

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
curl -X POST http://localhost:3000/api/contact \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test User",
    "phone": "+7 930 123 45 67",
    "message": "Test message"
  }'
```

### –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ –≤ –ª–æ–≥–∞—Ö:
```
[Telegram] Sending message to 2 recipient(s): 277767867, 956005680
[Telegram] Sending to chat_id #1: 277767867
[Telegram] üîÑ Preparing message for chat 277767867
[Telegram] üì° Sending HTTP request to Telegram API for chat 277767867...
[Telegram] ‚úÖ Message successfully sent to chat 277767867, message_id: 12345
[Telegram] Sending to chat_id #2: 956005680
[Telegram] üîÑ Preparing message for chat 956005680
[Telegram] üì° Sending HTTP request to Telegram API for chat 956005680...
[Telegram] ‚úÖ Message successfully sent to chat 956005680, message_id: 12346
[Telegram] üìä Results: 2 successful, 0 failed out of 2 total
  ‚úÖ Chat 277767867: Delivered
  ‚úÖ Chat 956005680: Delivered
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "No valid chat IDs found"
**–ü—Ä–∏—á–∏–Ω–∞:** `TELEGRAM_CHAT_ID` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –ø—É—Å—Ç–æ–π

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env
cat .env | grep TELEGRAM_CHAT_ID

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
TELEGRAM_CHAT_ID=277767867,956005680
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: "Bad Request: chat not found"
**–ü—Ä–∏—á–∏–Ω–∞:** –£–∫–∞–∑–∞–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π chat_id

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–∞—Ç
2. –î–ª—è –ª–∏—á–Ω—ã—Ö —á–∞—Ç–æ–≤: –Ω–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É `/start`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ chat_id —á–µ—Ä–µ–∑ –±–æ—Ç–∞ `@userinfobot`

---

### –ü—Ä–æ–±–ª–µ–º–∞: –ß–∞—Å—Ç–∏—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞
**–°–∏–º–ø—Ç–æ–º:** –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç `1 successful, 1 failed`

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - —Ç–∞–º –±—É–¥–µ—Ç —É–∫–∞–∑–∞–Ω –ø—Ä–æ–±–ª–µ–º–Ω—ã–π chat_id
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω –≤ —ç—Ç–æ–º —á–∞—Ç–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ –±–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

---

## üìù –ú–∏–≥—Ä–∞—Ü–∏—è

–ï—Å–ª–∏ –≤—ã –æ–±–Ω–æ–≤–ª—è–µ—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–µ–∫—Ç:

1. **–û–±–Ω–æ–≤–∏—Ç–µ `.env`:**
   ```bash
   # –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (—Ä–∞–±–æ—Ç–∞–µ—Ç)
   TELEGRAM_CHAT_ID=277767867
   
   # –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
   TELEGRAM_CHAT_ID=277767867,956005680
   ```

2. **–ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è** - –≤—Å–µ –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ!

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
   ```bash
   npm run dev
   # –∏–ª–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
   npm run build && npm start
   ```

---

## üéâ –ò—Ç–æ–≥–∏

### –ß—Ç–æ –ø–æ–ª—É—á–∏–ª–∏:
- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ Telegram —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É–¥–∞—á–Ω—ã—Ö –¥–æ—Å—Ç–∞–≤–æ–∫
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –æ–¥–Ω–∏–º chat_id
- ‚úÖ –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—à–∏–±–∫–∞–º (partial success)

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `Promise.allSettled()` –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
- –ù–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ–¥–Ω–æ–≥–æ –∏–∑ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 5 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 2.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

